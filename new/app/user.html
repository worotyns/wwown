<section x-data="data({from: '2023-12-24', to: '2024-01-01', lastItems: 10}, '/users/' + $router.params.user_id)">
    <h2><a x-link href="/">ðŸ”™&nbsp;</a><span x-text="t($router.params.user_id)"></span></h2>
    <div>
        <!-- Activity matrix -->
        <figure>
            <div class="cal">
                <template x-for="(day, index) in get('activityAllTime')" :key="index">
                    <div :class="{day: true, incident: day[5]}"
                        :style="`font-size: 10px; cursor: pointer; background-color: ${day[1]}`"
                        :title="`${day[0]}: ${day[2]} interactions by ${day[3]} users in ${day[4]} channels`"></div>
                </template>
            </div>
            <figcaption>Last year activity - interactions per day</figcaption>
        </figure>

        <figure>
            <div class="bar-chart" style="margin: auto; height: 80px; width: 540px;">
                <template x-for="(item, hour) of get('hourlyAllTime')">
                    <div x-data="{all: get('hourlyAllTime')[hour], range: get('hourlyInRange')[hour]}" class="bar-container">
                        <div class="bar">
                            <div class="bar-fill" :style="{'height': (range[1] * 200) + 'px'}"></div>
                        </div>
                        <div class="bar">
                            <div class="bar-fill-all" :style="{'height': (all[1] * 200) + 'px'}"></div>
                        </div>
                        <label x-text="hour"></label>
                    </div>
                </template>
            </div>
            <figcaption>Messages distribution in <span class="bar-legend-second">all-time</span> and <span class="bar-legend-main">in-range</figcaption>
        </figure>

        <!-- Last channels in date range -->
        <figure>
            <!-- Sample tags with different dimensions -->
            <template x-for="(item, index) in get('lastChannelsInRange')" :key="index">
                <div style="text-align: center; display: inline-block;"
                    x-init="minMax = get('lastChannelsInRangeMinMax')">
                    <div :style="`opacity: ${normalize(item[2], minMax[2], minMax[3], 0.10, 1)};`">
                        <a :title="`${item[1]} interactions ${timeAgo(item[2])}`" x-link
                            :href="'/channels/' + item[0] + ''">
                            <div
                                :style="`display: inline-block; margin: 2px; padding: 1.5px; border-radius: 5px; transition: transform 0.25s; background-color: rgba(211, 211, 211, 0.8); font-size: ${normalize(item[1], minMax[0], minMax[1], 10, 28)}px`">
                                <span x-text="'#' + t(item[0])"></span>
                            </div>
                        </a>
                    </div>
                </div>
            </template>
            <figcaption>Last channels where user was engaged in time</figcaption>
        </figure>

        <!-- Top channels in date range all time -->
        <figure>
            <template x-for="(item, index) in get('topChannelsAllTime')" :key="index">
                <div style="text-align: center; display: inline-block;"
                    x-init="minMax = get('topChannelsAllTimeMinMax')">
                    <div :style="`opacity: ${normalize(item[2], minMax[2], minMax[3], 0.10, 1)};`">
                        <a :title="`${item[1]} interactions ${timeAgo(item[2])}`" x-link
                            :href="'/channels/' + item[0] + ''">
                            <div
                                :style="`display: inline-block; margin: 2px; padding: 1.5px; border-radius: 5px; transition: transform 0.25s; background-color: rgba(211, 211, 211, 0.8); font-size: ${normalize(item[1], minMax[0], minMax[1], 10, 28)}px`">
                                <span x-text="'#' + t(item[0])"></span>
                            </div>
                        </a>
                    </div>
                </div>
            </template>
            <figcaption>Top channels where user was engaged all-time</figcaption>
        </figure>
    </div>
    <!--
    <div x-data="data({start: -7, end: 0}, '/activity/users/' + $router.params.user_id + '/daily')">
        <h3>Average daily user activity on slack with interactions (
            <input x-model="queryParams.start" type="number" min="-365" max="-1" step="7"/> days)
            <sub><span x-text="fetchTimeMs"></span>ms.</sub>
        </h3>
        <table>
            <thead>
                <tr>
                    <th style="min-width: 100px">day</th>
                    <th style="min-width: 100px">user</th>
                    <th>channels</th>
                    <th>threads</th>
                    <th>threads messages</th>
                    <th>avg threads messages</th>
                    <th>channel messages</th>
                    <th>channel reactions</th>
                    <th>avg channels messages</th>
                    <th>avg channels reactions</th>
                    <th>activity hours</th>
                    <th>channels avg activity hours</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(item, index) in items" :key="index">
                    <tr>
                        <td x-text="item.date"></td>
                        <td x-text="'@'+item.user_label"></td>
                        <td x-text="item.channels_count"></td>
                        <td x-text="item.threads_count"></td>
                        <td x-text="item.thread_messages_count"></td>
                        <td x-text="item.thread_messages_avg"></td>
                        <td x-text="item.channel_messages"></td>
                        <td x-text="item.channel_reactions"></td>
                        <td x-text="item.channel_messages_avg"></td>
                        <td x-text="item.channel_reactions_avg"></td>
                        <td x-text="item.activity_hours"></td>
                        <td x-text="item.activity_hours_avg"></td>
                    </tr>                    
                </template>
            </tbody>
        </table>
    </div>

    <h2>Karma</h2>

    <div x-data="data({start: -30, end: 0, limit: 10}, '/karma/users/' + $router.params.user_id + '/ranking')" >
        <h3>Aggregated reactions ranking (
            <input x-model="queryParams.start" type="number" min="-365" max="0" step="7"/> days, 
            <input x-model="queryParams.limit" type="number" min="1" max="100" step="5"/> items)
            <sub><span x-text="fetchTimeMs"></span>ms.</sub>
        </h3>
        <table>
            <thead>
                <tr>
                    <th>user</th>
                    <th>emoji</th>
                    <th>reactions</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(item, index) in items" :key="index">
                    <tr>
                        <td>
                            <span x-text="'@' + item.user_label"></span>
                        </td>
                        <td x-data="emojis()" x-init="init(item.emoji)">
                            <span x-show="isCustomEmoji && emoji" x-text="emoji"></span>
                            <img x-show="!isCustomEmoji && emoji" width="20px" height="20px" :src="emoji ? `https://emojicdn.elk.sh/${emoji}` : null" />
                        </td>
                        <td x-text="item.reaction_count"></td>
                    </tr>                    
                </template>
            </tbody>
        </table>
    </div>
-->
</section>